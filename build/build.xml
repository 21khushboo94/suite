<?xml version="1.0" encoding="UTF-8"?>
<project name="GeoExplorer" default="dist" basedir=".">

    <description>
        GeoExplorer Build File
    </description>

    <property file="build.properties"/>

    <property name="javasrc" location="../java/src"/>
    <property name="war" location="../java/war"/>
    <property name="build" location="geoexplorer"/>

    <path id="classpath">
        <fileset dir="${jars}" includes="**/*.jar"/>
    </path>
    
    <target name="init">
        <tstamp/>
        <mkdir dir="${build}"/>
    </target>
    
    <target name="compile">
        <mkdir dir="classes"/>
        <javac srcdir="${javasrc}" destdir="classes" classpathref="classpath" debug="on" />
    </target>
    
    <target name="jar" depends="compile">
        <mkdir dir="jars"/>
        <jar destfile="jars/JackServlet.jar" basedir="classes"/>
    </target>
    
    <target name="dist" depends="clean, init">

        <copy todir="${build}">
            <fileset dir="${war}"/>
        </copy>

        <mkdir dir="${build}/WEB-INF/lib"/>
        <copy file="../narwhal/engines/rhino/jars/js.jar" todir="${build}/WEB-INF/lib"/>
        
        <copy todir="${build}/WEB-INF/narwhal">
            <fileset dir="../narwhal">
                <exclude name="**/.svn/"/>
                <exclude name="**/.svn*"/>
                <exclude name="**/examples/"/>
                <exclude name="**/tests/"/>
                <exclude name="**/docs/"/>
                <exclude name="**/zips/"/>
                <exclude name="**/.tusk/"/>
                <exclude name="**/*.md"/>
            </fileset>
        </copy>
        
        <copy file="../narwhal/jackconfig.js" todir="${build}/WEB-INF"/>

    </target>
    
    <target name="clean" description="remove previous build">
        <delete dir="${build}"/>
    </target>
    
    <target name="war" depends="dist" description="create archive for servlet container">
        <war destfile="geoexplorer.war">
            <fileset dir="${build}"/>
        </war>
    </target>

</project>
