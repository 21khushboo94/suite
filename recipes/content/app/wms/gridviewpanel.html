<html>
    <head>
        <title>GeoExt WMS Browser</title>

        <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.2.1/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="http://extjs.cachefly.net/ext-3.2.1/ext-all.js"></script>
        <link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.2.1/resources/css/ext-all.css" />
        <script src="http://dev.openlayers.org/releases/OpenLayers-2.9.1/OpenLayers.js"></script>

        <script type="text/javascript" src="http://api.geoext.org/0.7/script/GeoExt.js"></script>
        <link rel="stylesheet" type="text/css" href="http://api.geoext.org/0.7/resources/css/geoext-all.css" />

        <script type="text/javascript">
        Ext.BLANK_IMAGE_URL = "http://extjs.cachefly.net/ext-3.2.1/resources/images/default/s.gif";

        Ext.onReady(function() {

            var grid = new Ext.grid.GridPanel({
                title: "Available WMS Layers",
                region: "north",
                height: 150,
                viewConfig: {forceFit: true},
                store: new GeoExt.data.WMSCapabilitiesStore({
                    url: "/geoserver/ows?SERVICE=WMS&REQUEST=GetCapabilities",
                    autoLoad: true
                }),
                columns: [
                    {header: "Name", dataIndex: "name", sortable: true},
                    {header: "Title", dataIndex: "title", sortable: true},
                    {header: "Abstract", dataIndex: "abstract"}
                ],
                bbar: [{
                    text: "Add To Map",
                    handler: function() {
                        grid.getSelectionModel().each(function(record) {
                            var clone = record.clone();
                            clone.get("layer").mergeNewParams({
                                format: "image/png",
                                transparent: true
                            });
                            mapPanel.layers.add(clone);
                            mapPanel.map.zoomToExtent(
                                OpenLayers.Bounds.fromArray(clone.get("llbbox"))
                            );
                        });
                    }
                }]
            });

            var mapPanel = new GeoExt.MapPanel({
                title: "Map",
                region: "center"
            });

            new Ext.Panel({
                renderTo: document.body,
                width: 800,
                height: 450,
                layout: "border",
                items: [grid, mapPanel]
            });

            var featureInfo = new OpenLayers.Control.WMSGetFeatureInfo();
            featureInfo.events.on({
                getfeatureinfo: function(e) {
                    new GeoExt.Popup({
                        title: "Feature Info",
                        width: 200,
                        height: 150,
                        autoScroll: true,
                        maximizable: true,
                        map: mapPanel.map,
                        lonlat: mapPanel.map.getLonLatFromPixel(e.xy),
                        html: e.text
                    }).show();
                }
            });
            mapPanel.map.addControl(featureInfo);
            featureInfo.activate();

        });


        </script>
    </head>
    <body>
    </body>
</html>
