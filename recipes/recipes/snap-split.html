<html>
    <head>
        <title>Snapping &amp; Splitting</title>
        <link rel="stylesheet" type="text/css" href="../externals/ext/resources/css/ext-all.css" />
        <link rel="stylesheet" type="text/css" href="../externals/ext/resources/css/xtheme-gray.css" />
        <script type="text/javascript" src="../externals/ext/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="../externals/ext/ext-all.js"></script>
        <link rel="stylesheet" href="../externals/openlayers/theme/default/style.css" type="text/css" />
        <link rel="stylesheet" href="../resources/theme/style.css" type="text/css" />
        <style type="text/css">
            .olControlEditingToolbar .olControlModifyFeatureItemInactive { 
                background-position: -1px 0px ;                                                                   
            }
            .olControlEditingToolbar .olControlModifyFeatureItemActive { 
                background-position: -1px -23px ;                                                                   
            }
            label.head {
                font-weight: bold;
                padding: 1em 0 0.1em 0;
                border-bottom: 1px solid grey;
            }
            td {
                padding: 0.25em 1em;
            }
            tr.head td {
                text-align: center;
                font-weight: bold;
            }
        </style>
        <script src="../externals/openlayers/build/OpenLayers.js"></script>
        <script src="snap-split.js"></script>
        <script>
            OpenLayers.ImgPath = "../externals/openlayers/img/";
        </script>
    </head>
    <body onload="init(); initUI();" class="recipe-body">
        <h1>Snapping &amp; Splitting Example</h1>
        <div class="description">
            A demonstration snapping and splitting while editing vector features.
        </div>
        <div class="content">
            <div id="map" class="map"></div>
            <br/>
            <input type="checkbox" id="snap_toggle" />
            <label for="snap_toggle" class="head">Enable Snapping</label>
            <table id="snap_options">
                <tbody>
                    <tr class="head">
                        <td>target</td><td>node</td><td>vertex</td><td>edge</td>
                    </tr>
                    <tr>
                        <td>roads</td>
                        <td><input type="checkbox" id="target_node" /><input id="target_nodeTolerance" type="text" size="3" /></td>
                        <td><input type="checkbox" id="target_vertex" /><input id="target_vertexTolerance" type="text" size="3" /></td>
                        <td><input type="checkbox" id="target_edge" /><input id="target_edgeTolerance" type="text" size="3" /></td>
                    </tr>
                </tbody>
            </table>
            <br />
            <input type="checkbox" id="split_toggle" />
            <label for="split_toggle" class="head">Enable Splitting</label>
            <table id="split_options">
                <tbody>
                    <tr>
                        <td><label for="edge_toggle">edges split</label></td>
                        <td><input type="checkbox" id="edge_toggle" /></td>
                    </tr>
                </tbody>
            </table>
            <br />
            <button id="clear">clear</button> Clear all features.
        </div>
        <script>
            /**
             * Add behavior to page elements.  This basically lets us set snapping
             * target properties with the checkboxes and text inputs.  The checkboxes
             * toggle the target node, vertex, or edge (boolean) values.  The
             * text inputs set the nodeTolerance, vertexTolerance, or edgeTolerance
             * property values.
             */
            function initUI() {
                // add behavior to snap elements
                var snapCheck = $("snap_toggle");
                snapCheck.checked = true;
                snapCheck.onclick = function() {
                    if(snapCheck.checked) {
                        snap.activate();
                        $("snap_options").style.display = "block";
                    } else {
                        snap.deactivate();
                        $("snap_options").style.display = "none";
                    }
                };
                var target, type, tog, tol;
                var types = ["node", "vertex", "edge"];
                var target = snap.targets[0];
                for(var j=0; j<types.length; ++j) {
                    type = types[j];
                    tog = $("target_" + type);
                    tog.checked = target[type];
                    tog.onclick = (function(tog, type, target) {
                        return function() {target[type] = tog.checked;}
                    })(tog, type, target);
                    tol = $("target_" + type + "Tolerance");
                    tol.value = target[type + "Tolerance"];
                    tol.onchange = (function(tol, type, target) {
                        return function() {
                            target[type + "Tolerance"] = Number(tol.value) || 0;
                        }
                    })(tol, type, target);
                }

                // add behavior to split elements
                var splitCheck = $("split_toggle");
                splitCheck.checked = true;
                splitCheck.onclick = function() {
                    if(splitCheck.checked) {
                        split.activate();
                        $("split_options").style.display = "block";
                    } else {
                        split.deactivate();
                        $("split_options").style.display = "none";
                    }
                };
                var edgeCheck = $("edge_toggle");
                edgeCheck.checked = split.edge;
                edgeCheck.onclick = function() {
                    split.edge = edgeCheck.checked;
                };

                $("clear").onclick = function() {
                    modify.deactivate();
                    vectors.destroyFeatures();
                };

            }
        </script>
    </body>
</html>
